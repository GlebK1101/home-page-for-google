<!DOCTYPE html>
<!-- Hatsune Miku | Kasane Teto | Akita Neru | Eleanor Forte | Adachi Rei | Gumi -->
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home page</title>
    <style>
        :root {
            --bg-color: #f4f6f8;
            --container-bg: #ffffff;
            --text-color: #333333;
            --accent-color: #2196F3;
            --accent-hover: #1976D2;
            --border-color: #ddd;
            --header-bg: #e0e0e0;
            --tab-inactive: #cfcfcf;
            --tab-active: #ffffff;
            --row-odd: #f2f8fd;
            --row-even: #ffffff;
            --modal-overlay: rgba(0,0,0,0.5);
        }

        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
        [data-theme="dark"] {
            --bg-color: #121212;
            --container-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent-color: #64b5f6;
            --accent-hover: #42a5f5;
            --border-color: #444;
            --header-bg: #2c2c2c;
            --tab-inactive: #333;
            --tab-active: #1e1e1e;
            --row-odd: #252525;
            --row-even: #1e1e1e;
            --modal-overlay: rgba(255,255,255,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }

        /* –†–∞–∑–º–µ—Ä—ã —à—Ä–∏—Ñ—Ç–∞ (–∫–ª–∞—Å—Å—ã –±—É–¥—É—Ç –≤–µ—à–∞—Ç—å—Å—è –Ω–∞ body) */
        .font-small { font-size: 14px; }
        .font-medium { font-size: 16px; }
        .font-large { font-size: 18px; }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--container-bg);
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        /* --- –®–∞–ø–∫–∞ --- */
        .header-bar {
            background-color: var(--header-bg);
            /* padding: 10px 10px 0 10px; */
            display: flex;
            align-items: flex-end; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –Ω–∏–∑—É –≤–∫–ª–∞–¥–∫–∏ */
            /* border-bottom: 1px solid var(--border-color); */
            gap: 10px;
            overflow: hidden; /* –ß—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–ª–µ–∑–∞–ª–æ */
        }

        .tabs-container {
            display: flex;
            flex: 1; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ */
            overflow-x: auto; /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
            
            /* –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–æ—Å—É –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none;  /* IE and Edge */
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–æ—Å—É –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –¥–ª—è Chrome/Safari/Opera */
        .tabs-container::-webkit-scrollbar {
            display: none;
        }

        /* –í–∫–ª–∞–¥–∫–∞ */
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            background-color: var(--tab-inactive);
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            user-select: none;
            transition: background 0.2s;
            color: var(--text-color);
            border: 1px solid transparent;
        }

        .tab.active {
            background-color: var(--tab-active);
            color: var(--accent-color);
            border-bottom: 1px solid var(--tab-active);
            margin-bottom: -1px; /* –°–ª–∏–≤–∞–µ—Ç—Å—è —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º */
            z-index: 2;
        }

        .tab:hover:not(.active) {
            background-color: #dcdcdc;
        }
        [data-theme="dark"] .tab:hover:not(.active) {
            background-color: #444;
        }

        .tab-settings-icon {
            font-size: 12px;
            opacity: 0.5;
            padding: 2px;
            border-radius: 3px;
        }
        .tab-settings-icon:hover {
            opacity: 1;
            background-color: rgba(0,0,0,0.1);
        }
        [data-theme="dark"] .tab-settings-icon:hover {
            background-color: rgba(255,255,255,0.2);
        }

        /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–ª–æ–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏ */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 5px;
            padding-bottom: 5px; /* –ß—É—Ç—å –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
            flex-shrink: 0; /* –ó–∞–ø—Ä–µ—â–∞–µ–º —Å–∂–∏–º–∞—Ç—å—Å—è —ç—Ç–æ–º—É –±–ª–æ–∫—É */
            background-color: var(--header-bg); /* –§–æ–Ω –∫–∞–∫ —É —à–∞–ø–∫–∏ */
            z-index: 10;
        }

        /* –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã –æ–Ω–∞ –≤—ã–≥–ª—è–¥–µ–ª–∞ –∫–∞–∫ –∏–∫–æ–Ω–∫–∞ –≤ –±–ª–æ–∫–µ –¥–µ–π—Å—Ç–≤–∏–π */
        .add-tab-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            width: 32px; 
            height: 32px;
            border-radius: 4px; /* –î–µ–ª–∞–µ–º –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–π —Å —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º */
            cursor: pointer;
            font-size: 20px;
            display: flex; 
            justify-content: center;
            align-items: center;
            padding: 0;
            line-height: 0;
        }
        .add-tab-btn:hover { background-color: var(--accent-hover); }

        .global-settings-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
            padding: 0;
            margin: 0;
            width: 32px;
            height: 32px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .global-settings-btn:hover { transform: rotate(30deg); transition: 0.3s; }

        /* --- –ö–æ–Ω—Ç–µ–Ω—Ç --- */
        .content-area {
            padding: 20px;
            flex: 1;
        }

        .input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.03);
            padding: 15px;
            border-radius: 5px;
            align-items: center;
        }

        input, select {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--container-bg);
            color: var(--text-color);
        }

        .btn-primary {
            padding: 8px 15px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-primary:hover { background-color: var(--accent-hover); }
        .btn-primary:disabled { background-color: #ccc; cursor: not-allowed; }

        /* –¢–∞–±–ª–∏—Ü–∞ */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid var(--border-color); padding: 12px; text-align: left; }
        th { background-color: var(--accent-color); color: white; }
        
        tbody tr:nth-child(odd) { background-color: var(--row-odd); }
        tbody tr:nth-child(even) { background-color: var(--row-even); }
        
        a.table-link { color: var(--accent-color); text-decoration: none; font-weight: bold; }
        a.table-link:hover { text-decoration: underline; }

        .btn-del {
            background-color: #ff5252; color: white; border: none; padding: 5px 10px;
            border-radius: 3px; cursor: pointer;
        }

        /* --- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ --- */
        .modal-overlay {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--modal-overlay);
            z-index: 1000;
            justify-content: center; align-items: center;
        }
        .modal {
            background: var(--container-bg);
            padding: 20px;
            border-radius: 8px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        .modal h2 { margin-top: 0; }
        .modal-close {
            position: absolute; top: 10px; right: 10px;
            background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-color);
        }
        .setting-group { margin-bottom: 15px; }
        .setting-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .full-width { width: 100%; box-sizing: border-box; }
        .btn-block { width: 100%; margin-top: 5px; padding: 10px; }
        
        .loading-spinner {
            display: inline-block; width: 12px; height: 12px;
            border: 2px solid rgba(255,255,255,0.3); border-radius: 50%;
            border-top-color: #fff; animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π --- */
        
        /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ */
        td {
            vertical-align: middle; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
        }
        
        /* –ö–ª–∞—Å—Å—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ */
        .col-center { text-align: center; }
        .col-desc { text-align: justify; } /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ —à–∏—Ä–∏–Ω–µ */
        
        /* –ö–Ω–æ–ø–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ */
        .row-actions {
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        .btn-icon {
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        .btn-icon:hover { background-color: rgba(0,0,0,0.1); }
        [data-theme="dark"] .btn-icon:hover { background-color: rgba(255,255,255,0.2); }

        /* –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Toasts) */
        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none; /* –ß—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å–∫–∞–ª–∏ –∫–ª–∏–∫–∏ —Å–∫–≤–æ–∑—å —Å–µ–±—è */
        }
        
        .toast {
            background: #333;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease-out;
            min-width: 250px;
            max-width: 350px;
            font-size: 14px;
            pointer-events: auto;
            opacity: 0.95;
        }
        
        .toast.error { background: #d32f2f; color: white; }
        .toast.success { background: #43a047; color: white; }
        .toast.warning { background: #ffa000; color: #fff; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 0.95; transform: translateX(0); }
        }

    </style>
</head>
<body class="font-medium">

<div class="container">
    <div class="header-bar">
        <div class="tabs-container" id="tabsContainer">
            <!-- –í–∫–ª–∞–¥–∫–∏ –∑–¥–µ—Å—å -->
        </div>
        <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –∫–Ω–æ–ø–æ–∫ -->
        <div class="header-actions">
            <button class="add-tab-btn" onclick="addNewTab()" title="–ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞">+</button>
            <button class="global-settings-btn" onclick="openGlobalSettings()" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
        </div>
    </div>

    <div class="content-area" id="contentArea">
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∑–¥–µ—Å—å -->
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
<div id="modalGlobal" class="modal-overlay">
    <div class="modal">
        <button class="modal-close" onclick="closeModal('modalGlobal')">&times;</button>
        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
        
        <div class="setting-group">
            <label>–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</label>
            <select id="themeSelect" class="full-width" onchange="changeTheme(this.value)">
                <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
                <option value="dark">–¢–µ–º–Ω–∞—è</option>
            </select>
        </div>

        <div class="setting-group">
            <label>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞</label>
            <select id="fontSizeSelect" class="full-width" onchange="changeFontSize(this.value)">
                <option value="font-small">–ú–∞–ª–µ–Ω—å–∫–∏–π</option>
                <option value="font-medium">–°—Ä–µ–¥–Ω–∏–π</option>
                <option value="font-large">–ë–æ–ª—å—à–æ–π</option>
            </select>
        </div>

        <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 20px 0;">
        
        <div class="setting-group">
            <label>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ (–í—Å–µ –≤–∫–ª–∞–¥–∫–∏)</label>
            <button class="btn-primary btn-block" onclick="exportAllData()">–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ–≥–æ –≤ JSON</button>
            <button class="btn-primary btn-block" style="background-color: #ff9800; margin-top: 10px;" onclick="document.getElementById('importAllInput').click()">–ò–º–ø–æ—Ä—Ç –∏–∑ JSON</button>
            <input type="file" id="importAllInput" style="display:none" onchange="importAllData(this)">
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –í–∫–ª–∞–¥–∫–∏ -->
<div id="modalTab" class="modal-overlay">
    <div class="modal">
        <button class="modal-close" onclick="closeModal('modalTab')">&times;</button>
        <h2 id="modalTabTitle">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∫–ª–∞–¥–∫–∏</h2>
        
        <div class="setting-group">
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏</label>
            <input type="text" id="tabRenameInput" class="full-width">
            <button class="btn-primary btn-block" style="margin-top:5px" onclick="saveTabRename()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ</button>
        </div>

        <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 20px 0;">

        <div class="setting-group">
            <label>–î–µ–π—Å—Ç–≤–∏—è</label>
            <button class="btn-primary btn-block" onclick="exportCurrentTab()">–≠–∫—Å–ø–æ—Ä—Ç —ç—Ç–æ–π –≤–∫–ª–∞–¥–∫–∏</button>
            <button class="btn-primary btn-block" style="background-color: #ff9800; margin-top: 10px;" onclick="document.getElementById('importTabInput').click()">–ò–º–ø–æ—Ä—Ç –≤ —ç—Ç—É –≤–∫–ª–∞–¥–∫—É</button>
            <input type="file" id="importTabInput" style="display:none" onchange="importTabData(this)">
            
            <button class="btn-del btn-block" style="margin-top: 20px;" onclick="deleteCurrentTab()">–£–¥–∞–ª–∏—Ç—å –≤–∫–ª–∞–¥–∫—É</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ -->
<div id="modalRowEdit" class="modal-overlay">
    <div class="modal">
        <button class="modal-close" onclick="closeModal('modalRowEdit')">&times;</button>
        <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å</h2>
        
        <div class="setting-group">
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input type="text" id="editRowTitle" class="full-width">
        </div>
        <div class="setting-group">
            <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <input type="text" id="editRowDesc" class="full-width">
        </div>
        <div class="setting-group">
            <label>–°—Å—ã–ª–∫–∞</label>
            <input type="text" id="editRowLink" class="full-width">
        </div>

        <div class="setting-group">
             <button class="btn-primary btn-block" onclick="saveRowEdit()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </div>
    </div>
</div>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
<div id="toastContainer" class="toast-container"></div>

<script>
    // --- State Management ---
    const DEFAULT_DATA = [ { name: "–ì–ª–∞–≤–Ω–∞—è", rows: [] } ];
    const DEFAULT_SETTINGS = { theme: 'light', fontSize: 'font-medium' };

    let appData = JSON.parse(localStorage.getItem('myApp_Data')) || DEFAULT_DATA;
    let settings = JSON.parse(localStorage.getItem('myApp_Settings')) || DEFAULT_SETTINGS;
    let activeTabIndex = 0;
    
    // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ –≤–∫–ª–∞–¥–∫–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ—Ç–æ—Ä–æ–π –æ—Ç–∫—Ä—ã—Ç—ã
    let editingTabIndex = -1; 

    // --- Init ---
    function init() {
        applySettings();
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –ø—Ä–∏—à–ª–∏ –ø—É—Å—Ç—ã–µ
        if (!Array.isArray(appData) || appData.length === 0) appData = DEFAULT_DATA;
        render();
    }

    function saveAll() {
        localStorage.setItem('myApp_Data', JSON.stringify(appData));
        localStorage.setItem('myApp_Settings', JSON.stringify(settings));
    }

    // --- Settings Logic ---
    function applySettings() {
        document.documentElement.setAttribute('data-theme', settings.theme);
        document.body.className = settings.fontSize;
        
        // Update UI controls in modal
        document.getElementById('themeSelect').value = settings.theme;
        document.getElementById('fontSizeSelect').value = settings.fontSize;
    }

    function changeTheme(val) {
        settings.theme = val;
        applySettings();
        saveAll();
    }

    function changeFontSize(val) {
        settings.fontSize = val;
        applySettings();
        saveAll();
    }

    // --- YouTube Fetch Logic ---
    async function fetchYoutubeTitle(url) {
        // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, –ø–æ—Ö–æ–∂–∞ –ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ —é—Ç—É–±
        if (!url.includes('youtube.com') && !url.includes('youtu.be')) return null;

        try {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º noembed.com –∫–∞–∫ –ø—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ–∫—Å–∏ –¥–ª—è oEmbed
            const apiUrl = `https://noembed.com/embed?url=${encodeURIComponent(url)}`;
            const res = await fetch(apiUrl);
            const data = await res.json();
            return data.title || null;
        } catch (e) {
            console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞:", e);
            return null;
        }
    }

    // --- Core Functionality ---

    function addNewTab() {
        const name = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–∏:", "–ù–æ–≤–∞—è");
        if (name) {
            appData.push({ name: name, rows: [] });
            activeTabIndex = appData.length - 1;
            saveAll();
            render();
        }
    }

    async function addRow() {
        const titleInput = document.getElementById('inTitle');
        const descInput = document.getElementById('inDesc');
        const linkInput = document.getElementById('inLink');
        const btn = document.getElementById('btnAddRow');

        let title = titleInput.value.trim();
        const link = linkInput.value.trim();
        const desc = descInput.value.trim();

        // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É
        if (!link && !title) {
            showToast("–£–∫–∞–∂–∏—Ç–µ —Å—Å—ã–ª–∫—É –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ!", "warning");
            return;
        }

        let finalTitle = title;

        // 2. –õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞, –Ω–æ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∞)
        if (!title && link) {
            btn.innerHTML = '<span class="loading-spinner"></span>';
            btn.disabled = true;

            const fetched = await fetchYoutubeTitle(link);
            
            if (fetched) {
                finalTitle = fetched;
                showToast("–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —Å YouTube", "success");
            } else {
                // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —ç—Ç–æ –Ω–µ —é—Ç—É–±
                finalTitle = "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"; 
                showToast("–ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ. –í—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å.", "warning");
            }

            btn.innerHTML = '–î–æ–±–∞–≤–∏—Ç—å';
            btn.disabled = false;
        }

        // –ï—Å–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–∫ –∏ –æ—Å—Ç–∞–ª—Å—è –ø—É—Å—Ç—ã–º (–∏ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞)
        if (!finalTitle) finalTitle = "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";

        appData[activeTabIndex].rows.push({
            title: finalTitle,
            desc: desc,
            link: link
        });
        
        // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π
        titleInput.value = '';
        descInput.value = '';
        linkInput.value = '';
        
        saveAll();
        renderContent();
    }

    function deleteRow(index) {
        // if(confirm("–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?")) { –ü–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é –º–æ–∂–µ—Ç–µ –≤–∫–ª—é—á–∏—Ç—å.
        if(true) {
            appData[activeTabIndex].rows.splice(index, 1);
            saveAll();
            renderContent();
        }
    }

    // --- Tab Settings Logic ---
    
    function openTabSettings(e, index) {
        e.stopPropagation(); // –ß—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–ª–∞—Å—å –≤–∫–ª–∞–¥–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —à–µ—Å—Ç–µ—Ä–µ–Ω–∫—É
        editingTabIndex = index;
        document.getElementById('tabRenameInput').value = appData[index].name;
        document.getElementById('modalTabTitle').innerText = `–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∫–ª–∞–¥–∫–∏: ${appData[index].name}`;
        
        document.getElementById('modalTab').style.display = 'flex';
    }

    function saveTabRename() {
        const newName = document.getElementById('tabRenameInput').value.trim();
        if(newName) {
            appData[editingTabIndex].name = newName;
            saveAll();
            renderTabs();
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–∞–ª–∫–∏
            document.getElementById('modalTabTitle').innerText = `–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∫–ª–∞–¥–∫–∏: ${newName}`;
            // –ï—Å–ª–∏ –º—ã –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª–∏ —Ç–µ–∫—É—â—É—é –≤–∫–ª–∞–¥–∫—É, –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–ø—É—Ç
            if (editingTabIndex === activeTabIndex) renderContent();
        }
    }

    function deleteCurrentTab() {
        // –í–æ—Ç —Ç—É—Ç –ø–æ–º–µ–Ω—è—Ç—å, –µ—Å–ª–∏ –±–µ—Å–∏—Ç—å –±—É–¥–µ—Ç. –ê –ª—É—á—à–µ –≤–æ–æ–±—â–µ –¥–æ–ø. –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–¥–µ–ª–∞—Ç—å.
        if(confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í–∫–ª–∞–¥–∫–∞ –∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.")) {
            appData.splice(editingTabIndex, 1);
            // –ï—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ –∞–∫—Ç–∏–≤–Ω—É—é –∏–ª–∏ —Ç—É, —á—Ç–æ –ø–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–Ω–æ–π, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –∏–Ω–¥–µ–∫—Å
            if (appData.length === 0) {
                appData.push({ name: "–ì–ª–∞–≤–Ω–∞—è", rows: [] });
                activeTabIndex = 0;
            } else if (editingTabIndex <= activeTabIndex) {
                activeTabIndex = Math.max(0, activeTabIndex - 1);
            }
            
            saveAll();
            closeModal('modalTab');
            render();
        }
    }

    // --- Import / Export Logic ---

    function downloadJSON(data, filename) {
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
    }

    function exportAllData() {
        const date = new Date().toISOString().slice(0,10);
        downloadJSON(appData, `my_dashboard_backup_${date}.json`);
    }

    function importAllData(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const json = JSON.parse(e.target.result);
                if (Array.isArray(json)) {
                    if(confirm("–≠—Ç–æ –∑–∞–º–µ–Ω–∏—Ç –í–°–ï –≤–∞—à–∏ —Ç–µ–∫—É—â–∏–µ –≤–∫–ª–∞–¥–∫–∏. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?")) {
                        appData = json;
                        activeTabIndex = 0;
                        saveAll();
                        render();
                        closeModal('modalGlobal');
                    }
                } else {
                    alert("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞");
                }
            } catch (err) { alert("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ JSON"); }
        };
        reader.readAsText(file);
        input.value = ''; // —Å–±—Ä–æ—Å
    }

    function exportCurrentTab() {
        const tab = appData[editingTabIndex];
        const safeName = tab.name.replace(/[^a-z0-9–∞-—è—ë]/gi, '_');
        downloadJSON(tab, `tab_${safeName}.json`);
    }

    function importTabData(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const json = JSON.parse(e.target.result);
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ –ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∫–ª–∞–¥–∫–∏ (—Å –∏–º–µ–Ω–µ–º –∏ rows) –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –º–∞—Å—Å–∏–≤ rows?
                // –ü–æ–¥–¥–µ—Ä–∂–∏–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞.
                let rowsToAdd = [];
                if (Array.isArray(json)) {
                    rowsToAdd = json; // –ï—Å–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç–æ –º–∞—Å—Å–∏–≤ –∑–∞–ø–∏—Å–µ–π
                } else if (json.rows && Array.isArray(json.rows)) {
                    rowsToAdd = json.rows; // –ï—Å–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç –≤–∫–ª–∞–¥–∫–∏
                }

                if (rowsToAdd.length > 0) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∑–∞–ø–∏—Å—è–º
                    appData[editingTabIndex].rows = appData[editingTabIndex].rows.concat(rowsToAdd);
                    saveAll();
                    renderContent();
                    alert(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${rowsToAdd.length}`);
                    closeModal('modalTab');
                } else {
                    alert("–í —Ñ–∞–π–ª–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã");
                }
            } catch (err) { alert("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞"); }
        };
        reader.readAsText(file);
        input.value = '';
    }

    // --- Rendering ---

    function renderTabs() {
        const container = document.getElementById('tabsContainer');
        container.innerHTML = '';
        
        appData.forEach((tab, index) => {
            const tabDiv = document.createElement('div');
            tabDiv.className = `tab ${index === activeTabIndex ? 'active' : ''}`;
            
            // –ù–∞–∑–≤–∞–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏
            const spanName = document.createElement('span');
            spanName.innerText = tab.name;
            tabDiv.appendChild(spanName);

            // –ò–∫–æ–Ω–∫–∞ —à–µ—Å—Ç–µ—Ä–µ–Ω–∫–∏ –≤–Ω—É—Ç—Ä–∏ –≤–∫–ª–∞–¥–∫–∏
            const gear = document.createElement('span');
            gear.className = 'tab-settings-icon';
            gear.innerHTML = '‚öôÔ∏è';
            gear.title = '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç—Ç–æ–π –≤–∫–ª–∞–¥–∫–∏';
            gear.onclick = (e) => openTabSettings(e, index);
            tabDiv.appendChild(gear);

            // –ö–ª–∏–∫ –ø–æ —Å–∞–º–æ–π –≤–∫–ª–∞–¥–∫–µ
            tabDiv.onclick = () => {
                activeTabIndex = index;
                render();
            };

            container.appendChild(tabDiv);
        });
    }

    function renderContent() {
        const container = document.getElementById('contentArea');
        container.innerHTML = '';
        
        if(!appData[activeTabIndex]) return;
        const currentTab = appData[activeTabIndex];

        // –ü–æ–ª—è –≤–≤–æ–¥–∞
        const inputsDiv = document.createElement('div');
        inputsDiv.className = 'input-row';
        inputsDiv.innerHTML = `
            <input type="text" id="inLink" placeholder="–°—Å—ã–ª–∫–∞" style="flex:1">
            <input type="text" id="inTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" style="flex:1">
            <input type="text" id="inDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" style="flex:2">
            <button class="btn-primary" id="btnAddRow" onclick="addRow()">–î–æ–±–∞–≤–∏—Ç—å</button>
        `;
        container.appendChild(inputsDiv);

        // –¢–∞–±–ª–∏—Ü–∞
        const table = document.createElement('table');
        table.innerHTML = `
            <thead>
                <tr>
                    <th style="width: 50px;" class="col-center">‚Ññ</th>
                    <th style="width: 25%;">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                    <th style="width: 10%;" class="col-center">–°—Å—ã–ª–∫–∞</th>
                    <th style="width: 80px;" class="col-center">–î–µ–π—Å—Ç–≤–∏–µ</th>
                </tr>
            </thead>
        `;
        const tbody = document.createElement('tbody');
        
        if (currentTab.rows.length === 0) {
            tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:20px; color:gray">–í–∫–ª–∞–¥–∫–∞ –ø—É—Å—Ç–∞</td></tr>`;
        } else {
            currentTab.rows.forEach((row, idx) => {
                const tr = document.createElement('tr');
                
                let linkHtml = row.link ? `<a href="${row.link}" target="_blank" class="table-link">–ü–µ—Ä–µ–π—Ç–∏</a>` : '-';
                
                tr.innerHTML = `
                    <td class="col-center">${idx + 1}</td>
                    <td><strong>${row.title}</strong></td>
                    <td class="col-desc">${row.desc}</td>
                    <td class="col-center">${linkHtml}</td>
                    <td class="col-center">
                        <div class="row-actions">
                            <button class="btn-icon" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" onclick="openRowEdit(${idx})">‚öôÔ∏è</button>
                            <button class="btn-icon" title="–£–¥–∞–ª–∏—Ç—å" style="color:#ff5252" onclick="deleteRow(${idx})">üóëÔ∏è</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        table.appendChild(tbody);
        container.appendChild(table);
    }

    function render() {
        renderTabs();
        renderContent();
    }

    // --- Modal Utils ---
    function openGlobalSettings() {
        document.getElementById('modalGlobal').style.display = 'flex';
    }
    
    function closeModal(id) {
        document.getElementById(id).style.display = 'none';
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª–∫–∏. –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç~ 
    window.onclick = function(event) {
        if (event.target.classList.contains('modal-overlay')) {
            event.target.style.display = "none";
        }
    }

    // --- Notification Logic ---
    function showToast(message, type = 'info') {
        const container = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerText = message;
        
        container.appendChild(toast);

        // –£–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => toast.remove(), 300); // –ñ–¥–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
        }, 2000);
    }

    // --- Row Editing Logic ---
    let editingRowIndex = -1;

    function openRowEdit(index) {
        editingRowIndex = index;
        const row = appData[activeTabIndex].rows[index];
        
        document.getElementById('editRowTitle').value = row.title;
        document.getElementById('editRowDesc').value = row.desc;
        document.getElementById('editRowLink').value = row.link;
        
        document.getElementById('modalRowEdit').style.display = 'flex';
    }

    function saveRowEdit() {
        if (editingRowIndex === -1) return;

        const newTitle = document.getElementById('editRowTitle').value.trim();
        const newDesc = document.getElementById('editRowDesc').value.trim();
        const newLink = document.getElementById('editRowLink').value.trim();

        if (!newTitle && !newLink) {
            showToast("–ù—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ö–æ—Ç—è –±—ã –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ —Å—Å—ã–ª–∫—É", "error");
            return;
        }

        appData[activeTabIndex].rows[editingRowIndex] = {
            title: newTitle || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",
            desc: newDesc,
            link: newLink
        };

        saveAll();
        renderContent();
        closeModal('modalRowEdit');
        showToast("–ó–∞–ø–∏—Å—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞", "success");
    }

    // --- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –∫–æ–ª–µ—Å–∏–∫–æ–º –º—ã—à–∏ ---
    const tabsContainer = document.getElementById('tabsContainer');
    
    tabsContainer.addEventListener('wheel', (evt) => {
        // –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –º–µ–Ω—å—à–µ —á–µ–º —à–∏—Ä–∏–Ω–∞ –æ–∫–Ω–∞, —Å–∫—Ä–æ–ª–ª –Ω–µ –Ω—É–∂–µ–Ω
        if (tabsContainer.scrollWidth <= tabsContainer.clientWidth) return;

        evt.preventDefault();
        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω–∞–ª—å–Ω–æ –Ω–∞ –≤–µ–ª–∏—á–∏–Ω—É –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∫–æ–ª–µ—Å–∞
        tabsContainer.scrollLeft += evt.deltaY;
    });

    // –ó–∞–ø—É—Å–∫
    init();
</script>

</body>
</html>