<!DOCTYPE html>
<!-- Hatsune Miku | Kasane Teto | Akita Neru | Eleanor Forte | Adachi Rei | Gumi -->
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strona startowa</title>
    <style>
        :root {
            --bg-color: #f4f6f8;
            --container-bg: #ffffff;
            --text-color: #333333;
            --accent-color: #2196F3;
            --accent-hover: #1976D2;
            --border-color: #ddd;
            --header-bg: #e0e0e0;
            --tab-inactive: #cfcfcf;
            --tab-active: #ffffff;
            --row-odd: #f2f8fd;
            --row-even: #ffffff;
            --modal-overlay: rgba(0,0,0,0.5);
        }

        /* Ciemny motyw */
        [data-theme="dark"] {
            --bg-color: #121212;
            --container-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent-color: #64b5f6;
            --accent-hover: #42a5f5;
            --border-color: #444;
            --header-bg: #2c2c2c;
            --tab-inactive: #333;
            --tab-active: #1e1e1e;
            --row-odd: #252525;
            --row-even: #1e1e1e;
            --modal-overlay: rgba(255,255,255,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Rozmiary czcionek (klasy przypisywane do body) */
        .font-small { font-size: 14px; }
        .font-medium { font-size: 16px; }
        .font-large { font-size: 18px; }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--container-bg);
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        /* --- Nag≈Ç√≥wek --- */
        .header-bar {
            background-color: var(--header-bg);
            /* padding: 10px 10px 0 10px; */
            display: flex;
            align-items: flex-end; /* Wyr√≥wnanie do do≈Çu karty */
            /* border-bottom: 1px solid var(--border-color); */
            gap: 10px;
            overflow: hidden; /* Aby nic nie wystawa≈Ço */
        }

        .tabs-container {
            display: flex;
            flex: 1; /* Zajmuje ca≈Çe wolne miejsce */
            overflow-x: auto; /* Przewijanie poziome */
            
            /* Ukrywamy pasek przewijania */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none;  /* IE and Edge */
        }

        /* Ukrywamy pasek przewijania dla Chrome/Safari/Opera */
        .tabs-container::-webkit-scrollbar {
            display: none;
        }

        /* Karta (Tab) */
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            background-color: var(--tab-inactive);
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            user-select: none;
            transition: background 0.2s;
            color: var(--text-color);
            border: 1px solid transparent;
        }

        .tab.active {
            background-color: var(--tab-active);
            color: var(--accent-color);
            border-bottom: 1px solid var(--tab-active);
            margin-bottom: -1px; /* Zlewa siƒô z zawarto≈õciƒÖ */
            z-index: 2;
        }

        .tab:hover:not(.active) {
            background-color: #dcdcdc;
        }
        [data-theme="dark"] .tab:hover:not(.active) {
            background-color: #444;
        }

        .tab-settings-icon {
            font-size: 12px;
            opacity: 0.5;
            padding: 2px;
            border-radius: 3px;
        }
        .tab-settings-icon:hover {
            opacity: 1;
            background-color: rgba(0,0,0,0.1);
        }
        [data-theme="dark"] .tab-settings-icon:hover {
            background-color: rgba(255,255,255,0.2);
        }

        /* Sta≈Çy blok z przyciskami */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 5px;
            padding-bottom: 5px; /* Lekki odstƒôp od do≈Çu */
            flex-shrink: 0; /* Zapobiegamy zmniejszaniu siƒô tego bloku */
            background-color: var(--header-bg); /* T≈Ço jak w nag≈Ç√≥wku */
            z-index: 10;
        }

        /* Dostosowanie przycisku dodawania, aby wyglƒÖda≈Ç jak ikona w bloku akcji */
        .add-tab-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            width: 32px; 
            height: 32px;
            border-radius: 4px; /* Robimy kwadrat z zaokrƒÖgleniem */
            cursor: pointer;
            font-size: 20px;
            display: flex; 
            justify-content: center;
            align-items: center;
            padding: 0;
            line-height: 0;
        }
        .add-tab-btn:hover { background-color: var(--accent-hover); }

        .global-settings-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
            padding: 0;
            margin: 0;
            width: 32px;
            height: 32px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .global-settings-btn:hover { transform: rotate(30deg); transition: 0.3s; }

        /* --- Tre≈õƒá --- */
        .content-area {
            padding: 20px;
            flex: 1;
        }

        .input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.03);
            padding: 15px;
            border-radius: 5px;
            align-items: center;
        }

        input, select {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--container-bg);
            color: var(--text-color);
        }

        .btn-primary {
            padding: 8px 15px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-primary:hover { background-color: var(--accent-hover); }
        .btn-primary:disabled { background-color: #ccc; cursor: not-allowed; }

        /* Tabela */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid var(--border-color); padding: 12px; text-align: left; }
        th { background-color: var(--accent-color); color: white; }
        
        tbody tr:nth-child(odd) { background-color: var(--row-odd); }
        tbody tr:nth-child(even) { background-color: var(--row-even); }
        
        a.table-link { color: var(--accent-color); text-decoration: none; font-weight: bold; }
        a.table-link:hover { text-decoration: underline; }

        .btn-del {
            background-color: #ff5252; color: white; border: none; padding: 5px 10px;
            border-radius: 3px; cursor: pointer;
        }

        /* --- Okna modalne --- */
        .modal-overlay {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--modal-overlay);
            z-index: 1000;
            justify-content: center; align-items: center;
        }
        .modal {
            background: var(--container-bg);
            padding: 20px;
            border-radius: 8px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        .modal h2 { margin-top: 0; }
        .modal-close {
            position: absolute; top: 10px; right: 10px;
            background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-color);
        }
        .setting-group { margin-bottom: 15px; }
        .setting-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .full-width { width: 100%; box-sizing: border-box; }
        .btn-block { width: 100%; margin-top: 5px; padding: 10px; }
        
        .loading-spinner {
            display: inline-block; width: 12px; height: 12px;
            border: 2px solid rgba(255,255,255,0.3); border-radius: 50%;
            border-top-color: #fff; animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- style dla tabeli i powiadomie≈Ñ --- */
        
        /* Wyr√≥wnanie w tabeli */
        td {
            vertical-align: middle; /* Wy≈õrodkowanie w pionie */
        }
        
        /* Klasy dla konkretnych kolumn */
        .col-center { text-align: center; }
        .col-desc { text-align: justify; } /* Wyjustowanie tekstu opisu */
        
        /* Przyciski w tabeli */
        .row-actions {
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        .btn-icon {
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        .btn-icon:hover { background-color: rgba(0,0,0,0.1); }
        [data-theme="dark"] .btn-icon:hover { background-color: rgba(255,255,255,0.2); }

        /* Powiadomienia (Toasts) */
        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none; /* Aby przepuszcza≈Çy klikniƒôcia przez siebie */
        }
        
        .toast {
            background: #333;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease-out;
            min-width: 250px;
            max-width: 350px;
            font-size: 14px;
            pointer-events: auto;
            opacity: 0.95;
        }
        
        .toast.error { background: #d32f2f; color: white; }
        .toast.success { background: #43a047; color: white; }
        .toast.warning { background: #ffa000; color: #fff; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 0.95; transform: translateX(0); }
        }

    </style>
</head>
<body class="font-medium">

<div class="container">
    <div class="header-bar">
        <div class="tabs-container" id="tabsContainer">
            <!-- Karty tutaj -->
        </div>
        <!-- Sta≈Çy obszar przycisk√≥w -->
        <div class="header-actions">
            <button class="add-tab-btn" onclick="addNewTab()" title="Nowa karta">+</button>
            <button class="global-settings-btn" onclick="openGlobalSettings()" title="Ustawienia">‚öôÔ∏è</button>
        </div>
    </div>

    <div class="content-area" id="contentArea">
        <!-- Tre≈õƒá tutaj -->
    </div>
</div>

<!-- Okno modalne: Ustawienia globalne -->
<div id="modalGlobal" class="modal-overlay">
    <div class="modal">
        <button class="modal-close" onclick="closeModal('modalGlobal')">&times;</button>
        <h2>Ustawienia</h2>
        
        <div class="setting-group">
            <label>Motyw</label>
            <select id="themeSelect" class="full-width" onchange="changeTheme(this.value)">
                <option value="light">Jasny</option>
                <option value="dark">Ciemny</option>
            </select>
        </div>

        <div class="setting-group">
            <label>Rozmiar czcionki</label>
            <select id="fontSizeSelect" class="full-width" onchange="changeFontSize(this.value)">
                <option value="font-small">Ma≈Çy</option>
                <option value="font-medium">≈öredni</option>
                <option value="font-large">Du≈ºy</option>
            </select>
        </div>

        <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 20px 0;">
        
        <div class="setting-group">
            <label>ZarzƒÖdzanie danymi (Wszystkie karty)</label>
            <button class="btn-primary btn-block" onclick="exportAllData()">Eksportuj wszystko do JSON</button>
            <button class="btn-primary btn-block" style="background-color: #ff9800; margin-top: 10px;" onclick="document.getElementById('importAllInput').click()">Importuj z JSON</button>
            <input type="file" id="importAllInput" style="display:none" onchange="importAllData(this)">
        </div>
    </div>
</div>

<!-- Okno modalne: Ustawienia Karty -->
<div id="modalTab" class="modal-overlay">
    <div class="modal">
        <button class="modal-close" onclick="closeModal('modalTab')">&times;</button>
        <h2 id="modalTabTitle">Ustawienia karty</h2>
        
        <div class="setting-group">
            <label>Nazwa karty</label>
            <input type="text" id="tabRenameInput" class="full-width">
            <button class="btn-primary btn-block" style="margin-top:5px" onclick="saveTabRename()">Zapisz nazwƒô</button>
        </div>

        <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 20px 0;">

        <div class="setting-group">
            <label>Akcje</label>
            <button class="btn-primary btn-block" onclick="exportCurrentTab()">Eksportuj tƒô kartƒô</button>
            <button class="btn-primary btn-block" style="background-color: #ff9800; margin-top: 10px;" onclick="document.getElementById('importTabInput').click()">Importuj do tej karty</button>
            <input type="file" id="importTabInput" style="display:none" onchange="importTabData(this)">
            
            <button class="btn-del btn-block" style="margin-top: 20px;" onclick="deleteCurrentTab()">Usu≈Ñ kartƒô</button>
        </div>
    </div>
</div>

<!-- Okno modalne: Edycja wpisu -->
<div id="modalRowEdit" class="modal-overlay">
    <div class="modal">
        <button class="modal-close" onclick="closeModal('modalRowEdit')">&times;</button>
        <h2>Edytuj wpis</h2>
        
        <div class="setting-group">
            <label>Tytu≈Ç</label>
            <input type="text" id="editRowTitle" class="full-width">
        </div>
        <div class="setting-group">
            <label>Opis</label>
            <input type="text" id="editRowDesc" class="full-width">
        </div>
        <div class="setting-group">
            <label>Link</label>
            <input type="text" id="editRowLink" class="full-width">
        </div>

        <div class="setting-group">
             <button class="btn-primary btn-block" onclick="saveRowEdit()">Zapisz zmiany</button>
        </div>
    </div>
</div>

<!-- Kontener powiadomie≈Ñ -->
<div id="toastContainer" class="toast-container"></div>

<script>
    // --- State Management ---
    const DEFAULT_DATA = [ { name: "G≈Ç√≥wna", rows: [] } ];
    const DEFAULT_SETTINGS = { theme: 'light', fontSize: 'font-medium' };

    let appData = JSON.parse(localStorage.getItem('myApp_Data')) || DEFAULT_DATA;
    let settings = JSON.parse(localStorage.getItem('myApp_Settings')) || DEFAULT_SETTINGS;
    let activeTabIndex = 0;
    
    // Zmienna do przechowywania indeksu karty, kt√≥rej ustawienia sƒÖ otwarte
    let editingTabIndex = -1; 

    // --- Init ---
    function init() {
        applySettings();
        // Walidacja danych, je≈õli nagle przysz≈Çy puste
        if (!Array.isArray(appData) || appData.length === 0) appData = DEFAULT_DATA;
        render();
    }

    function saveAll() {
        localStorage.setItem('myApp_Data', JSON.stringify(appData));
        localStorage.setItem('myApp_Settings', JSON.stringify(settings));
    }

    // --- Settings Logic ---
    function applySettings() {
        document.documentElement.setAttribute('data-theme', settings.theme);
        document.body.className = settings.fontSize;
        
        // Update UI controls in modal
        document.getElementById('themeSelect').value = settings.theme;
        document.getElementById('fontSizeSelect').value = settings.fontSize;
    }

    function changeTheme(val) {
        settings.theme = val;
        applySettings();
        saveAll();
    }

    function changeFontSize(val) {
        settings.fontSize = val;
        applySettings();
        saveAll();
    }

    // --- YouTube Fetch Logic ---
    async function fetchYoutubeTitle(url) {
        // Proste sprawdzenie, czy link wyglƒÖda na youtube
        if (!url.includes('youtube.com') && !url.includes('youtu.be')) return null;

        try {
            // U≈ºywamy noembed.com jako publicznego proxy dla oEmbed
            const apiUrl = `https://noembed.com/embed?url=${encodeURIComponent(url)}`;
            const res = await fetch(apiUrl);
            const data = await res.json();
            return data.title || null;
        } catch (e) {
            console.error("B≈ÇƒÖd pobierania tytu≈Çu:", e);
            return null;
        }
    }

    // --- Core Functionality ---

    function addNewTab() {
        const name = prompt("Nazwa nowej karty:", "Nowa");
        if (name) {
            appData.push({ name: name, rows: [] });
            activeTabIndex = appData.length - 1;
            saveAll();
            render();
        }
    }

    async function addRow() {
        const titleInput = document.getElementById('inTitle');
        const descInput = document.getElementById('inDesc');
        const linkInput = document.getElementById('inLink');
        const btn = document.getElementById('btnAddRow');

        let title = titleInput.value.trim();
        const link = linkInput.value.trim();
        const desc = descInput.value.trim();

        // 1. Sprawdzenie czy puste
        if (!link && !title) {
            showToast("Podaj link lub tytu≈Ç!", "warning");
            return;
        }

        let finalTitle = title;

        // 2. Logika autouzupe≈Çniania (tylko je≈õli nie ma tytu≈Çu, ale jest link)
        if (!title && link) {
            btn.innerHTML = '<span class="loading-spinner"></span>';
            btn.disabled = true;

            const fetched = await fetchYoutubeTitle(link);
            
            if (fetched) {
                finalTitle = fetched;
                showToast("Tytu≈Ç pobrany z YouTube", "success");
            } else {
                // Je≈õli nie uda≈Ço siƒô pobraƒá lub to nie youtube
                finalTitle = "Bez tytu≈Çu"; 
                showToast("Nie uda≈Ço siƒô automatycznie pobraƒá tytu≈Çu. Mo≈ºesz edytowaƒá wpis.", "warning");
            }

            btn.innerHTML = 'Dodaj';
            btn.disabled = false;
        }

        // Je≈õli tytu≈Ç nadal pozosta≈Ç pusty (i autopobieranie nie zadzia≈Ça≈Ço)
        if (!finalTitle) finalTitle = "Bez tytu≈Çu";

        appData[activeTabIndex].rows.push({
            title: finalTitle,
            desc: desc,
            link: link
        });
        
        // Czyszczenie p√≥l
        titleInput.value = '';
        descInput.value = '';
        linkInput.value = '';
        
        saveAll();
        renderContent();
    }

    function deleteRow(index) {
        // if(confirm("UsunƒÖƒá wpis?")) { Wed≈Çug uznania mo≈ºna w≈ÇƒÖczyƒá.
        if(true) {
            appData[activeTabIndex].rows.splice(index, 1);
            saveAll();
            renderContent();
        }
    }

    // --- Tab Settings Logic ---
    
    function openTabSettings(e, index) {
        e.stopPropagation(); // Aby nie prze≈ÇƒÖcza≈Ça siƒô karta przy klikniƒôciu w zƒôbatkƒô
        editingTabIndex = index;
        document.getElementById('tabRenameInput').value = appData[index].name;
        document.getElementById('modalTabTitle').innerText = `Ustawienia karty: ${appData[index].name}`;
        
        document.getElementById('modalTab').style.display = 'flex';
    }

    function saveTabRename() {
        const newName = document.getElementById('tabRenameInput').value.trim();
        if(newName) {
            appData[editingTabIndex].name = newName;
            saveAll();
            renderTabs();
            // Aktualizujemy nag≈Ç√≥wek modala
            document.getElementById('modalTabTitle').innerText = `Ustawienia karty: ${newName}`;
            // Je≈õli zmienili≈õmy nazwƒô bie≈ºƒÖcej karty, aktualizujemy input
            if (editingTabIndex === activeTabIndex) renderContent();
        }
    }

    function deleteCurrentTab() {
        // Tutaj zmieniƒá, je≈õli bƒôdzie irytowaƒá. A najlepiej zrobiƒá dodatkowe ustawienie.
        if(confirm("Czy na pewno? Karta i wszystkie dane zostanƒÖ usuniƒôte.")) {
            appData.splice(editingTabIndex, 1);
            // Je≈õli usunƒôli≈õmy aktywnƒÖ lub tƒô przed aktywnƒÖ, korygujemy indeks
            if (appData.length === 0) {
                appData.push({ name: "G≈Ç√≥wna", rows: [] });
                activeTabIndex = 0;
            } else if (editingTabIndex <= activeTabIndex) {
                activeTabIndex = Math.max(0, activeTabIndex - 1);
            }
            
            saveAll();
            closeModal('modalTab');
            render();
        }
    }

    // --- Import / Export Logic ---

    function downloadJSON(data, filename) {
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
    }

    function exportAllData() {
        const date = new Date().toISOString().slice(0,10);
        downloadJSON(appData, `my_dashboard_backup_${date}.json`);
    }

    function importAllData(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const json = JSON.parse(e.target.result);
                if (Array.isArray(json)) {
                    if(confirm("To zastƒÖpi WSZYSTKIE twoje obecne karty. Kontynuowaƒá?")) {
                        appData = json;
                        activeTabIndex = 0;
                        saveAll();
                        render();
                        closeModal('modalGlobal');
                    }
                } else {
                    alert("Nieprawid≈Çowy format pliku");
                }
            } catch (err) { alert("B≈ÇƒÖd odczytu pliku JSON"); }
        };
        reader.readAsText(file);
        input.value = ''; // reset
    }

    function exportCurrentTab() {
        const tab = appData[editingTabIndex];
        const safeName = tab.name.replace(/[^a-z0-9–∞-—è—ë]/gi, '_');
        downloadJSON(tab, `tab_${safeName}.json`);
    }

    function importTabData(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const json = JSON.parse(e.target.result);
                // Sprawdzamy, czy to pe≈Çna struktura karty (z nazwƒÖ i rows) czy tylko tablica rows?
                // Obs≈Çu≈ºymy oba warianty.
                let rowsToAdd = [];
                if (Array.isArray(json)) {
                    rowsToAdd = json; // Je≈õli importujemy po prostu tablicƒô wpis√≥w
                } else if (json.rows && Array.isArray(json.rows)) {
                    rowsToAdd = json.rows; // Je≈õli importujemy obiekt karty
                }

                if (rowsToAdd.length > 0) {
                    // Dodajemy do istniejƒÖcych wpis√≥w
                    appData[editingTabIndex].rows = appData[editingTabIndex].rows.concat(rowsToAdd);
                    saveAll();
                    renderContent();
                    alert(`Zaimportowano wpis√≥w: ${rowsToAdd.length}`);
                    closeModal('modalTab');
                } else {
                    alert("W pliku nie znaleziono wpis√≥w dla tabeli");
                }
            } catch (err) { alert("B≈ÇƒÖd odczytu pliku"); }
        };
        reader.readAsText(file);
        input.value = '';
    }

    // --- Rendering ---

    function renderTabs() {
        const container = document.getElementById('tabsContainer');
        container.innerHTML = '';
        
        appData.forEach((tab, index) => {
            const tabDiv = document.createElement('div');
            tabDiv.className = `tab ${index === activeTabIndex ? 'active' : ''}`;
            
            // Nazwa karty
            const spanName = document.createElement('span');
            spanName.innerText = tab.name;
            tabDiv.appendChild(spanName);

            // Ikona zƒôbatki wewnƒÖtrz karty
            const gear = document.createElement('span');
            gear.className = 'tab-settings-icon';
            gear.innerHTML = '‚öôÔ∏è';
            gear.title = 'Ustawienia tej karty';
            gear.onclick = (e) => openTabSettings(e, index);
            tabDiv.appendChild(gear);

            // Klikniƒôcie w samƒÖ kartƒô
            tabDiv.onclick = () => {
                activeTabIndex = index;
                render();
            };

            container.appendChild(tabDiv);
        });
    }

    function renderContent() {
        const container = document.getElementById('contentArea');
        container.innerHTML = '';
        
        if(!appData[activeTabIndex]) return;
        const currentTab = appData[activeTabIndex];

        // Pola wprowadzania
        const inputsDiv = document.createElement('div');
        inputsDiv.className = 'input-row';
        inputsDiv.innerHTML = `
            <input type="text" id="inLink" placeholder="Link" style="flex:1">
            <input type="text" id="inTitle" placeholder="Tytu≈Ç" style="flex:1">
            <input type="text" id="inDesc" placeholder="Opis" style="flex:2">
            <button class="btn-primary" id="btnAddRow" onclick="addRow()">Dodaj</button>
        `;
        container.appendChild(inputsDiv);

        // Tabela
        const table = document.createElement('table');
        table.innerHTML = `
            <thead>
                <tr>
                    <th style="width: 50px;" class="col-center">Nr</th>
                    <th style="width: 25%;">Tytu≈Ç</th>
                    <th>Opis</th>
                    <th style="width: 10%;" class="col-center">Link</th>
                    <th style="width: 80px;" class="col-center">Akcja</th>
                </tr>
            </thead>
        `;
        const tbody = document.createElement('tbody');
        
        if (currentTab.rows.length === 0) {
            tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:20px; color:gray">Karta jest pusta</td></tr>`;
        } else {
            currentTab.rows.forEach((row, idx) => {
                const tr = document.createElement('tr');
                
                let linkHtml = row.link ? `<a href="${row.link}" target="_blank" class="table-link">Otw√≥rz</a>` : '-';
                
                tr.innerHTML = `
                    <td class="col-center">${idx + 1}</td>
                    <td><strong>${row.title}</strong></td>
                    <td class="col-desc">${row.desc}</td>
                    <td class="col-center">${linkHtml}</td>
                    <td class="col-center">
                        <div class="row-actions">
                            <button class="btn-icon" title="Edytuj" onclick="openRowEdit(${idx})">‚öôÔ∏è</button>
                            <button class="btn-icon" title="Usu≈Ñ" style="color:#ff5252" onclick="deleteRow(${idx})">üóëÔ∏è</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        table.appendChild(tbody);
        container.appendChild(table);
    }

    function render() {
        renderTabs();
        renderContent();
    }

    // --- Modal Utils ---
    function openGlobalSettings() {
        document.getElementById('modalGlobal').style.display = 'flex';
    }
    
    function closeModal(id) {
        document.getElementById(id).style.display = 'none';
    }

    // Zamkniƒôcie po klikniƒôciu poza modalem. Zakomentowaƒá, je≈õli irytuje~ 
    window.onclick = function(event) {
        if (event.target.classList.contains('modal-overlay')) {
            event.target.style.display = "none";
        }
    }

    // --- Notification Logic ---
    function showToast(message, type = 'info') {
        const container = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerText = message;
        
        container.appendChild(toast);

        // Usuniƒôcie po 2 sekundach
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => toast.remove(), 300); // Czekamy na koniec animacji zanikania
        }, 2000);
    }

    // --- Row Editing Logic ---
    let editingRowIndex = -1;

    function openRowEdit(index) {
        editingRowIndex = index;
        const row = appData[activeTabIndex].rows[index];
        
        document.getElementById('editRowTitle').value = row.title;
        document.getElementById('editRowDesc').value = row.desc;
        document.getElementById('editRowLink').value = row.link;
        
        document.getElementById('modalRowEdit').style.display = 'flex';
    }

    function saveRowEdit() {
        if (editingRowIndex === -1) return;

        const newTitle = document.getElementById('editRowTitle').value.trim();
        const newDesc = document.getElementById('editRowDesc').value.trim();
        const newLink = document.getElementById('editRowLink').value.trim();

        if (!newTitle && !newLink) {
            showToast("Musisz wype≈Çniƒá przynajmniej tytu≈Ç lub link", "error");
            return;
        }

        appData[activeTabIndex].rows[editingRowIndex] = {
            title: newTitle || "Bez tytu≈Çu",
            desc: newDesc,
            link: newLink
        };

        saveAll();
        renderContent();
        closeModal('modalRowEdit');
        showToast("Wpis zaktualizowany", "success");
    }

    // --- Poziome przewijanie k√≥≈Çkiem myszy ---
    const tabsContainer = document.getElementById('tabsContainer');
    
    tabsContainer.addEventListener('wheel', (evt) => {
        // Je≈õli tre≈õƒá jest mniejsza ni≈º szeroko≈õƒá okna, przewijanie nie jest potrzebne
        if (tabsContainer.scrollWidth <= tabsContainer.clientWidth) return;

        evt.preventDefault();
        // Przewijamy poziomo o wielko≈õƒá przewiniƒôcia ko≈Ça
        tabsContainer.scrollLeft += evt.deltaY;
    });

    // Start
    init();
</script>

</body>
</html>